#!/usr/bin/env bash

setup_cmn()
{
    if [ ! -e ~/.tmux-themepack ]; then
        echo "=> Clone tmux-themepack"
        git clone https://github.com/jimeh/tmux-themepack.git ~/.tmux-themepack
    fi

    if ! which fasd 2>&1 > /dev/null; then
        echo "=> Clone fasd"
        rm -rf /tmp/fasd
        git clone https://github.com/clvv/fasd.git /tmp/fasd
        cd /tmp/fasd
        sudo make install
    fi

    if ! which fzf 2>&1 > /dev/null; then
        echo "=> Clone fzf"
        git clone --depth 1 https://github.com/junegunn/fzf.git ~/.fzf
        ~/.fzf/install
    fi

    if [ ! -e ~/.emacs.d ]; then
        git clone git@github.com:syl20bnr/spacemacs.git ~/.emacs.d -b develop
    fi
}

setup_nix()
{
    echo "=> Install apt packages"
    packages="curl emacs dex arandr cargo ncdu htop build-essential cmake tig silversearcher-ag multitail zsh vim tmux mpv rofi"
    sudo apt update -y
    sudo apt upgrade -y
    sudo apt install -y $packages

    if [ ! "$SHELL" -ef "$(which zsh)" ]; then
        echo "=> Change SHELL to $(which zsh)"
        chsh -s $(which zsh)
    fi

    if ! which rg 2>&1 > /dev/null; then
        echo "=> Installing ripgrep"
        #curl -ssf https://static.rust-lang.org/rustup.sh | sh
        cargo install ripgrep
    fi

}

setup_osx()
{
    if ! which brew 2>&1 > /dev/null; then
        echo "=> Install homebrew"
        /usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
    fi

    echo "=> Install homebrew packages"
    packages="zsh tmux mpv ripgrep nodejs"
    brew update
    brew install $packages
}

case "$(uname -a)" in
    *Ubuntu*)
        setup_cmn
        setup_nix
        ;;
    Darwin*)
        setup_cmn
        setup_osx
        ;;
    *)
        echo "unknown os";
        exit 1
        ;;
esac
